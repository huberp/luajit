--- luajit.c	2019-02-16 21:51:55 +0200
+++ ../../luajit-modified.c	2019-02-16 21:50:54 +0200
@@ -273,7 +273,23 @@
   const char *fname = argx[0];
   if (strcmp(fname, "-") == 0 && strcmp(argx[-1], "--") != 0)
     fname = NULL;  /* stdin */
-  status = luaL_loadfile(L, fname);
+#ifdef LUAPOWER_BUILD
+  // call require('terra') before running a *.t file.
+  if (fname) {
+	  int len = strlen(fname);
+	  if (len >= 3 && fname[len - 1] == 't' && fname[len - 2] == '.') {
+		  lua_getglobal(L, "require");
+		  lua_pushliteral(L, "terra");
+		  lua_call(L, 1, 0);
+	  }
+  }
+  // use terra-overriden _G.loadfile instead of luaL_loadfile.
+  lua_getglobal(L, "loadfile");
+  lua_pushstring(L, fname);
+  status = lua_pcall(L, 1, 1, 0);    // pushes the chunk or an error message
+#else
+  status = luaL_loadfile(L, fname);  // pushes the chunk or an error message
+#endif
   if (status == LUA_OK) {
     /* Fetch args from arg table. LUA_INIT or -e might have changed them. */
     int narg = 0;
